<!DOCTYPE html>
<html lang="en">
<head>
<title>PyDAIR Report</title>

<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

<style>
h1, h2, h3, h4, h5, h6 {
    font-family: -apple-system, Helvetica, Arial, sans-serif;
    font-weight: 100;
}
article {
    margin-top: 80px;
    font-family: -apple-system, Helvetica, Arial, sans-serif;
    font-weight: 100;
}

/* bootstrap style sheet */
.panel {
    margin-bottom: 20px;
    background-color: #fff;
    border: 1px solid transparent;
    border-radius: 4px;
    -webkit-box-shadow: 0 1px 1px rgba(0,0,0,.05);
    box-shadow: 0 1px 1px rgba(0,0,0,.05);
}
.panel-heading {
    padding: 10px 15px;
    border-bottom: 1px solid transparent;
    border-top-left-radius: 3px;
    border-top-right-radius: 3px;
}
.panel-default {
    border-color: #ddd;
}
.panel-danger {
    border-color: #ebccd1;
}
.panel-default > .panel-heading {
    color: #333;
    background-color: #f5f5f5;
    border-color: #ddd;
}
.panel-danger > .panel-heading {
    color: #a94442;
    background-color: #f2dede;
    border-color: #ebccd1;
}
.panel-body {
    padding: 15px;
}
</style>


</head>
<body>

<div class="container">
<article id="h_top">
    
    <section id="load_status" class="panel panel-danger" style="display:none;">
        <div class="panel-heading">Warnings</div>
        <div class="panel-body">
        <p>This page loads Google Charts API for drawing graphs and Bootstrap for rendering page desing via internect. Make sure you have internet connections.</p>
        </div>
    </section>


    
    <div class="page-header">
        <h1>PyDAIR Analysis Report</h1>
    </div>
    
    
    
    <section id="h_basic" class="panel panel-default">
        <div class="panel-heading"><h2>Basic statistics</h2></div>
        <div class="panel-body">
        <table class="table table-condensed">
        <thead>
        <tr>
            <td>Sample</td>
            <td># sequences</td>
            <td>V<br />frequency</td>
            <td>D<br />frequency</td>
            <td>J<br />frequency</td>
            <td>VDJ<br />frequency</td>
            <td>CDR3 length<br />frequency</td>
            <td>CDR3<br />sequence</td>
        </tr>
        </thead>
        <tbody>
        
            <tr>
            <td>Sample 1</td>
            <td>368</td>
            <td><a>TXT</a></td>
            <td><a>TXT</a></td>
            <td><a>TXT</a></td>
            <td><a>TXT</a></td>
            <td><a>TXT</a></td>
            <td><a>FASTA</a></td>
            </tr>
        
            <tr>
            <td>Sample 2</td>
            <td>388</td>
            <td><a>TXT</a></td>
            <td><a>TXT</a></td>
            <td><a>TXT</a></td>
            <td><a>TXT</a></td>
            <td><a>TXT</a></td>
            <td><a>FASTA</a></td>
            </tr>
        
            <tr>
            <td>Sample 3</td>
            <td>397</td>
            <td><a>TXT</a></td>
            <td><a>TXT</a></td>
            <td><a>TXT</a></td>
            <td><a>TXT</a></td>
            <td><a>TXT</a></td>
            <td><a>FASTA</a></td>
            </tr>
        
        </tbody>
        </table>
        </div>
    </section>




    
    <section id="h_V" class="panel panel-default">
        <div class="panel-heading"><h2>V gene usage</h2></div>
        <div class="row panel-body">
           <div class="col-md-4">
                <button type="button" class="btn btn-default" onClick="drawChartV(true)">Percentage</button>
                <button type="button" class="btn btn-default" onClick="drawChartV(false)">Frequency</button>
            </div>
            <div class="col-md-8">
                <div id="V_freq_plot"></div>
            </div>
        </div>
    </section>
    
    <section id="h_D" class="panel panel-default">
        <div class="panel-heading"><h2>D gene usage</h2></div>
        <div class="row panel-body">
           <div class="col-md-4">
                <button type="button" class="btn btn-default" onClick="drawChartD(true)">Percentage</button>
                <button type="button" class="btn btn-default" onClick="drawChartD(false)">Frequency</button>
            </div>
            <div class="col-md-8">
                <div id="D_freq_plot"></div>
            </div>
        </div>
    </section>
    
    <section id="h_J" class="panel panel-default">
        <div class="panel-heading"><h2>J gene usage</h2></div>
        <div class="row panel-body">
           <div class="col-md-4">
                <button type="button" class="btn btn-default" onClick="drawChartJ(true)">Percentage</button>
                <button type="button" class="btn btn-default" onClick="drawChartJ(false)">Frequency</button>
            </div>
            <div class="col-md-8">
                <div id="J_freq_plot"></div>
            </div>
        </div>
    </section>
    
 


    <section id="h_CDR3" class="panel panel-default">
        <div class="panel-heading"><h2>CDR3 length</h2></div>
        <div class="row panel-body">
           <div class="col-md-4">
                <button type="button" class="btn btn-default" onClick="drawChartCDR3Length(true)">Percentage</button>
                <button type="button" class="btn btn-default" onClick="drawChartCDR3Length(false)">Frequency</button>
            </div>
            <div class="col-md-8">
                <div id="cdr3len_freq_plot"></div>
            </div>
        </div>
    </section>
    
    
    
    
    <section id="h_rarefaction" class="panel panel-default">
        <div class="panel-heading"><h2>Rarefaction study for VDJ combinations</h2></div>
        <div class="row panel-body">
           <div class="col-md-4">
                <p>Basic statistics.</p>
                <textarea class="form-control" rows="10">CapturedSeq	Sample 1	Sample 2	Sample 3
1	1.0	1.0	1.0
2	1.3	1.1	1.0
3	1.0	1.3	1.4
4	1.3	1.5	1.3
5	1.5	1.5	1.6
6	1.8	1.2	1.3
7	1.2	1.5	1.6
8	1.5	1.5	1.9
9	1.6	2.0	1.9
10	1.8	2.1	1.9
20	3.2	2.8	2.4
40	4.6	4.2	3.6
60	5.0	5.8	6.0
80	7.8	7.1	6.8
100	8.0	7.8	8.7
200	13.9	14.4	15.1
300	18.1	17.9	17.5
368	21.0		
388		21.0	
397			21.0
</textarea>
            </div>
            <div class="col-md-8">
                <div id="rarefaction_VDJ_plot"></div>
            </div>
        </div>
    </section>
    
    
    
    
    

</article>       
</div>








</article>

</div>




<script type="text/javascript">
<!--
if (! navigator.onLine) {
    document.getElementById("load_status").style.display = "block";
    document.getElementById("load_status").style.visibility = "visible";
}


function jsonToDataTable(dataJson, idName = '', transToValue = false, prob = false) {
    var colNames = Object.keys(dataJson);
    var rowNames = Object.keys(dataJson[colNames[0]]);
    var dataTable = [];
    var dataTableHeader = [idName];
    for (var i = 0; i < colNames.length; i++) {
        dataTableHeader.push(colNames[i]);
    }
    dataTable.push(dataTableHeader);
    for (var j = 0; j < rowNames.length; j++) {
        var dataRow = [rowNames[j]];
        for (var i = 0; i < colNames.length; i++) {
            dataRow.push(dataJson[colNames[i]][rowNames[j]]);
        }
        dataTable.push(dataRow);
    }
    
   if (prob) {
        for (var j = 0; j < colNames.length; j++) {
            var sum = 0;
            for (var i = 0; i < rowNames.length; i++) {
                sum += dataTable[i + 1][j + 1];
            }
            for (var i = 0; i < rowNames.length; i++) {
                dataTable[i + 1][j + 1] = dataTable[i + 1][j + 1] / sum;
            }
        }
    }
    if (transToValue) {
        for (var i = 0; i < rowNames.length; i++) {
            dataTable[i + 1][0] = Number(dataTable[i + 1][0]);
        }
    }
    return {'dataTable': dataTable,
            'colNames' : colNames,
            'rowNames' : rowNames};
}


google.charts.load('current', {packages:['bar', 'line']});





google.charts.setOnLoadCallback(drawChartV);
function drawChartV(prob = true) {
    
    var xlab = "Frequency of V gene usage";
    var ylab = "V gene family";
    var axisFormat = "scientific"
    if (prob) {
        xlab = "Percentage of V gene usage";
        axisFormat = "percent"
    }
    
    var data = jsonToDataTable({"Sample 1":{"v1.14":99,"v1.8":64,"v1.13":57,"v1.16":45,"v1.2":39,"v1.21":16,"v1.1":13,"v1.17":14,"v1.7":7,"v1.3":7,"v1.12":4,"v1.4":1,"v1.18":1,"v1.15":1},"Sample 2":{"v1.14":103,"v1.8":69,"v1.13":58,"v1.16":50,"v1.2":41,"v1.21":16,"v1.1":16,"v1.17":14,"v1.7":7,"v1.3":7,"v1.12":4,"v1.4":1,"v1.18":1,"v1.15":1},"Sample 3":{"v1.14":107,"v1.8":70,"v1.13":59,"v1.16":50,"v1.2":42,"v1.21":16,"v1.1":16,"v1.17":16,"v1.7":7,"v1.3":7,"v1.12":4,"v1.4":1,"v1.18":1,"v1.15":1}}, 'Gene', false, prob);
    var dataTable = new google.visualization.arrayToDataTable(data.dataTable);
    var options = {
        title: 'V gene usage',
        height: 14 * (data.colNames.length) * (data.rowNames.length * 1.05) + 40,
        bars: 'horizontal',
        hAxis: {title: xlab, format: axisFormat},
        vAxis: {title: ylab},
    };
    var chart = new google.charts.Bar(document.getElementById('V_freq_plot'));
    chart.draw(dataTable, google.charts.Bar.convertOptions(options));
}

google.charts.setOnLoadCallback(drawChartD);
function drawChartD(prob = true) {
    
    var xlab = "Frequency of D gene usage";
    var ylab = "D gene family";
    var axisFormat = "scientific"
    if (prob) {
        xlab = "Percentage of D gene usage";
        axisFormat = "percent"
    }
    
    var data = jsonToDataTable({"Sample 1":{"Dm1":234,"Dm4":64,"Dm6":37,"Dm5":15,"Dm3":13,"Dm2":5},"Sample 2":{"Dm1":251,"Dm4":65,"Dm6":39,"Dm5":15,"Dm3":13,"Dm2":5},"Sample 3":{"Dm1":257,"Dm4":65,"Dm6":39,"Dm5":16,"Dm3":14,"Dm2":6}}, 'Gene', false, prob);
    var dataTable = new google.visualization.arrayToDataTable(data.dataTable);
    var options = {
        title: 'D gene usage',
        height: 14 * (data.colNames.length) * (data.rowNames.length * 1.05) + 40,
        bars: 'horizontal',
        hAxis: {title: xlab, format: axisFormat},
        vAxis: {title: ylab},
    };
    var chart = new google.charts.Bar(document.getElementById('D_freq_plot'));
    chart.draw(dataTable, google.charts.Bar.convertOptions(options));
}

google.charts.setOnLoadCallback(drawChartJ);
function drawChartJ(prob = true) {
    
    var xlab = "Frequency of J gene usage";
    var ylab = "J gene family";
    var axisFormat = "scientific"
    if (prob) {
        xlab = "Percentage of J gene usage";
        axisFormat = "percent"
    }
    
    var data = jsonToDataTable({"Sample 1":{"Jm1":194,"Jm2":131,"Jm3":28,"Jm4":11,"Jm5":4},"Sample 2":{"Jm1":202,"Jm2":138,"Jm3":32,"Jm4":12,"Jm5":4},"Sample 3":{"Jm1":206,"Jm2":141,"Jm3":34,"Jm4":12,"Jm5":4}}, 'Gene', false, prob);
    var dataTable = new google.visualization.arrayToDataTable(data.dataTable);
    var options = {
        title: 'J gene usage',
        height: 14 * (data.colNames.length) * (data.rowNames.length * 1.05) + 40,
        bars: 'horizontal',
        hAxis: {title: xlab, format: axisFormat},
        vAxis: {title: ylab},
    };
    var chart = new google.charts.Bar(document.getElementById('J_freq_plot'));
    chart.draw(dataTable, google.charts.Bar.convertOptions(options));
}



google.charts.setOnLoadCallback(drawChartCDR3Length);
function drawChartCDR3Length(prob = true) {
    
    var xlab = "CDR3 amino acid sequence length";
    var ylab = "Frequency of sequences";
    var axisFormat = "scientific"
    if (prob) {
        ylab = "Percentage of sequences";
        axisFormat = "percent"
    }
    
    var data = jsonToDataTable({"Sample 1":{"0":81,"11":4,"12":30,"13":27,"14":64,"15":28,"16":36,"17":84,"18":4,"19":8,"20":1,"21":1},"Sample 2":{"0":86,"11":5,"12":32,"13":30,"14":68,"15":29,"16":37,"17":86,"18":4,"19":9,"20":1,"21":1},"Sample 3":{"0":88,"11":5,"12":33,"13":31,"14":69,"15":30,"16":37,"17":89,"18":4,"19":9,"20":1,"21":1}}, 'Length', true, prob);
    var dataLimited = [data.dataTable[0]]
    for (var i = 0; i < data.rowNames.length; i++) {
        if (7 < Number(data.rowNames[i]) && Number(data.rowNames[i]) < 25) {
            dataLimited.push(data.dataTable[i + 1]);
        }
    }
    var dataTable = new google.visualization.arrayToDataTable(dataLimited);
    var options = {
        title: 'CDR3 length distribution',
        subtitle: 'Length distribution of complementarity determining region 3 (CDR3) amino acid sequences',
        height: 400,
        bars: 'vertical',
        vAxis: {title: ylab, format: axisFormat},
        hAxis: {title: xlab},
    };
    var chart = new google.charts.Bar(document.getElementById('cdr3len_freq_plot'));
    chart.draw(dataTable, google.charts.Bar.convertOptions(options));
}







google.charts.setOnLoadCallback(drawChartRarefactionVDJ);
function drawChartRarefactionVDJ() {
    var data = jsonToDataTable({"Sample 1":{"1":1.0,"2":1.3,"3":1.0,"4":1.3,"5":1.5,"6":1.8,"7":1.2,"8":1.5,"9":1.6,"10":1.8,"20":3.2,"40":4.6,"60":5.0,"80":7.8,"100":8.0,"200":13.9,"300":18.1,"368":21.0,"388":null,"397":null},"Sample 2":{"1":1.0,"2":1.1,"3":1.3,"4":1.5,"5":1.5,"6":1.2,"7":1.5,"8":1.5,"9":2.0,"10":2.1,"20":2.8,"40":4.2,"60":5.8,"80":7.1,"100":7.8,"200":14.4,"300":17.9,"368":null,"388":21.0,"397":null},"Sample 3":{"1":1.0,"2":1.0,"3":1.4,"4":1.3,"5":1.6,"6":1.3,"7":1.6,"8":1.9,"9":1.9,"10":1.9,"20":2.4,"40":3.6,"60":6.0,"80":6.8,"100":8.7,"200":15.1,"300":17.5,"368":null,"388":null,"397":21.0}}, 'numSeq', true, false);
    var dataTable = new google.visualization.arrayToDataTable(data.dataTable);
    var options = {
        title: 'Rarefaction study for VDJ combination diversity',
        subtitle: 'Rarefaction study for VDJ combination diversity',
        height: 400,
        hAxis: {title: 'Number of captured sequences', format: 'scientific'},
        vAxis: {title: 'Number of unique VDJ combinations'},
        interpolateNulls: true,
    };
    var chart = new google.charts.Line(document.getElementById('rarefaction_VDJ_plot'));

    chart.draw(dataTable, google.charts.Line.convertOptions(options));
}




-->
</script>







</body>
</html>